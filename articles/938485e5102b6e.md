---
title: "Status bar ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¢ãƒ—ãƒªã®é€šçŸ¥ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ°—åˆã„ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ã¦ã¿ãŸï¼ˆAndroidï¼‰"
emoji: "ğŸ””"
type: "tech"
topics: ["android", "kotlin"]
published: true
---

Android ç«¯æœ«ã«ãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ [Google Play](https://play.google.com/store) ã‚¹ãƒˆã‚¢ãŒæ–°è¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« or ã‚¢ãƒ—ãƒªæ›´æ–°ä¸­ã«è¡¨ç¤ºã™ã‚‹é€šçŸ¥ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚ˆã†ã« GIF ã£ã½ã„æŒ™å‹•ã‚’ã•ã›ã‚‹ã“ã¨ã¯ã§ããªã„ã‹æ°—ã«ãªã‚Šã¾ã—ãŸ ğŸ¤”

## ã‚µãƒ³ãƒ—ãƒ«

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«[ç™ºè¡Œæ¸ˆã¿é€šçŸ¥ã‚’æ›´æ–°ã™ã‚‹](https://developer.android.com/training/notify-user/build-notification#Updating)æ–¹æ³•ãŒè¼‰ã£ã¦ã„ãŸãŸã‚ã‚´ãƒªæŠ¼ã—ã§å®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸ ğŸ™‡â€
[`setOnlyAlertOnce()`](https://developer.android.com/reference/androidx/core/app/NotificationCompat.Builder#setOnlyAlertOnce(boolean)) ã‚’è¨­å®šã™ã‚‹ã¨ç™ºè¡Œæ¸ˆã¿ã®é€šçŸ¥ã‚’ [`NotificationManagerCompat.notify()`](https://developer.android.com/reference/androidx/core/app/NotificationManagerCompat#notify(int,%20android.app.Notification)) ã§æ›´æ–°ã—ã¦ã‚‚ã‚µã‚¦ãƒ³ãƒ‰ã‚’é³´ã‚‰ã•ãªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ ğŸ¤«

:::message
å®Ÿãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã«æŠ•å…¥ã§ãã‚‹å®Œæˆåº¦ã§ã¯ãªã„ã§ã™ ğŸ’¦
:::

```kt
class MainActivity : AppCompatActivity() {

  private val scope = CoroutineScope(Dispatchers.Default)

  override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)

    val binding: ActivityMainBinding = DataBindingUtil.setContentView(this, R.layout.activity_main)

    createNotificationChannelIfNeeded()

    val builder = NotificationCompat.Builder(this, CHANNEL_ID).also { builder ->
      builder.setContentTitle("ã‚¿ã‚¤ãƒˆãƒ«")
      builder.setContentText("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸")
      builder.setSmallIcon(R.drawable.ic_outline_star_24)
      builder.priority = NotificationCompat.PRIORITY_LOW
      builder.setOnlyAlertOnce(true)
    }

    val notificationManager = NotificationManagerCompat.from(this)

    scope.launch {
      var smallIconRes = R.drawable.ic_outline_star_half_24
      while (true) {
        val deferred = async(Dispatchers.IO) {
          Thread.sleep(500) // 0.5 ç§’å¾…ã¤

          when (smallIconRes) { // ã‚¢ã‚¤ã‚³ãƒ³ã¯ https://fonts.google.com/icons ã‹ã‚‰æ‹å€Ÿã—ã¾ã—ãŸ
            R.drawable.ic_outline_star_outline_24 -> R.drawable.ic_outline_star_half_24
            R.drawable.ic_outline_star_half_24 -> R.drawable.ic_outline_star_24
            else -> R.drawable.ic_outline_star_outline_24
          }
        }

        withContext(Dispatchers.Main) {
          smallIconRes = deferred.await()
          builder.setSmallIcon(smallIconRes)
          notificationManager.notify(NOTIFICATION_ID, builder.build())
        }
      }
    }
  }

  /**
   * ãƒãƒ£ãƒ³ãƒãƒ«ä½œæˆã®å¿…è¦ãŒã‚ã‚Œã°å®Ÿæ–½
   */
  private fun createNotificationChannelIfNeeded() {
    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
      val notificationManager = getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
      if (notificationManager.getNotificationChannel(CHANNEL_ID) == null) {
        val name = getString(R.string.channel_name)
        val importance = NotificationManager.IMPORTANCE_DEFAULT
        val channel = NotificationChannel(CHANNEL_ID, name, importance).also { channel ->
          channel.description = getString(R.string.channel_description)
          channel.setSound(null, null) // é€šçŸ¥éŸ³ã‚’é³´ã‚‰ã•ãªã„
        }
        notificationManager.createNotificationChannel(channel)
      }
    }
  }

  companion object {
    private const val CHANNEL_ID = "CHANNEL_ID"
    private const val NOTIFICATION_ID = 0
  }
}
```

## å®Ÿè¡Œçµæœ

é€šçŸ¥ã‚¢ã‚¤ã‚³ãƒ³ã‚’å‹•ã„ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ã›ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸ â­ï¸

![](https://storage.googleapis.com/zenn-user-upload/784vlkud9ftw745xqdhfab8qbfm5)